<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>Booking requests</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="fonts/icomoon/style.css" />
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

  <link rel="stylesheet" href="css/tiny-slider.css" />
  <link rel="stylesheet" href="css/aos.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/fontawesome.min.css" />

   <!-- <style>
    body { background: #f8f9fa; padding: 2rem; font-family: 'Cairo', sans-serif; }
    .card { border-radius: 10px; border: 1px solid #ddd; }
    .card-title { color: #00B98E; }
  </style>-->
 
</head>
<body>
  <div class="site-mobile-menu site-navbar-target">
    <div class="site-mobile-menu-header">
      <div class="site-mobile-menu-close">
        <span class="icofont-close js-menu-toggle"></span>
      </div>
    </div>
    <div class="site-mobile-menu-body"></div>
  </div>

  <nav class="site-nav">
    <div class="container">
      <div class="menu-bg-wrap">
        <div class="site-navigation">
          <a href="index.html" class="logo m-0 float-start">Booking requests</a>

          <ul
            class="js-clone-nav d-none d-lg-inline-block text-start site-menu float-end"
          >
            <li class="active"><a href="index.html">Home</a></li>
            <li class="has-children">
              <a href="Requests.html">Booking requests</a>
              <ul class="dropdown">
                <li><a href="#">Buy Property</a></li>
                <li><a href="#">Sell Property</a></li>
                <li class="has-children">
                  <a href="#">Dropdown</a>
                  <ul class="dropdown">
                    <li><a href="#">Sub Menu One</a></li>
                    <li><a href="#">Sub Menu Two</a></li>
                    <li><a href="#">Sub Menu Three</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="services.html">Services</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact Us</a></li>
          </ul>

          <a
            href="#"
            class="burger light me-auto float-end mt-1 site-menu-toggle js-menu-toggle d-inline-block d-lg-none"
            data-toggle="collapse"
            data-target="#main-navbar"
          >
            <span></span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div
      class="hero page-inner overlay"
      style="background-image: url('images/hero_bg_3.jpg')"
    >
      <div class="container">
        <div class="row justify-content-center align-items-center">
          <div class="col-lg-9 text-center mt-5">
            <h1 class="heading" data-aos="fade-up">Booking requests</h1>

            <nav
              aria-label="breadcrumb"
              data-aos="fade-up"
              data-aos-delay="200"
            >
              <ol class="breadcrumb text-center justify-content-center">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li
                  class="breadcrumb-item active text-white-50"
                  aria-current="page"
                >
                Booking requests
                </li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </div>

  <div class="container">
    <h2 class="text-center mb-4">Booking requests</h2>
    <div id="reservation-list" class="row justify-content-center"></div>
  </div>

  <script>
    const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6ImQxOGZiMmUxLWY0OTktNDZiZS05Y2NjLTBhOGVhZjdhYjA4MyIsInN1YiI6ImhlbmQ2MDc0IiwianRpIjoiOWQ4OGE1ZjYtOTk1NS00ZjY3LWJiNjYtM2E3YmE3ZmQ4ZTM5IiwiZW1haWwiOiJoZW5kQGguY29tIiwidWlkIjoiZDE4ZmIyZTEtZjQ5OS00NmJlLTljY2MtMGE4ZWFmN2FiMDgzIiwiZXhwIjoxNzQ5MDY5MjgyLCJpc3MiOiJTZWN1cmVBcGkiLCJhdWQiOiJTZWN1cmVBcGlVc2VyIn0.RYlFICCJgMFuEEpt9XN5FgQd35ApBEx6JK875RvTOvY";
   fetch("https://localhost:44327/api/Housing/landlordResrvation", {
  headers: {
    "Authorization": `Bearer ${token}`,
    "Content-Type": "application/json"
  }
})
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById("reservation-list");

    // التأكد إن البيانات عبارة عن مصفوفة
    const reservations = Array.isArray(data) ? data : [data];

    if (reservations.length === 0 || !reservations[0]) {
      container.innerHTML = `<p class="text-center">لا توجد طلبات حجز حالياً</p>`;
      return;
    }

    reservations.forEach(item => {
      const card = `
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card p-3 shadow-sm">
            <h5 class="card-title">طلب من: ${item.tenantName}</h5>
            <a href="RequestDetails.html?id=${item.id}" class="btn btn-primary mt-3">عرض التفاصيل</a>
          </div>
        </div>
      `;
      container.innerHTML += card;
    });
  })
  .catch(err => {
    document.getElementById("reservation-list").innerHTML = `<p class="text-danger">تعذر تحميل البيانات</p>`;
    console.error(err);
  });
   const contractModal = document.getElementById("contractModal");
  contractModal.addEventListener('show.bs.modal', function () {
    fetch(`https://localhost:44327/api/Housing/contract/${reservationId}`, {
      headers: {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      }
    })
    .then(res => res.json())
    .then(contract => {
      const date = new Date(contract.reservationDate).toLocaleDateString("ar-EG");
      const html = `
        <p><strong>اسم المؤجر:</strong> ${contract.landlordName}</p>
        <p><strong>هاتف المؤجر:</strong> ${contract.landlordPhone}</p>
        <p><strong>اسم المستأجر:</strong> ${contract.tenantName}</p>
        <p><strong>هاتف المستأجر:</strong> ${contract.tenantPhone}</p>
        <p><strong>العنوان:</strong> ${contract.housingAddress}</p>
        <p><strong>تاريخ الحجز:</strong> ${date}</p>
        <p><strong>المبلغ:</strong> ${contract.amountPaid} جنيه</p>
        <hr>
        <p>تم الاتفاق بين الطرفين على الحجز بالشروط التالية...</p>
        <p>توقيع المؤجر: _______________</p>
        <p>توقيع المستأجر: _______________</p>
      `;
      document.getElementById("contractContent").innerHTML = html;
    });
  });


  </script>
   <script src="js/bootstrap.bundle.min.js"></script>
   <script src="js/tiny-slider.js"></script>
   <script src="js/aos.js"></script>
   <script src="js/navbar.js"></script>
   <script src="js/counter.js"></script>
   <script src="js/custom.js"></script>

</body>
</html>
