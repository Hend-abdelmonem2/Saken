<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Booking requests</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="fonts/icomoon/style.css" />
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

  <link rel="stylesheet" href="css/tiny-slider.css" />
  <link rel="stylesheet" href="css/aos.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/fontawesome.min.css" />

   <!-- <style>
    body { background: #f8f9fa; padding: 2rem; font-family: 'Cairo', sans-serif; }
    .card { border-radius: 10px; border: 1px solid #ddd; }
    .card-title { color: #00B98E; }
  </style>-->
 
</head>
<body>
 <div id="navbar-placeholder"></div>

  <div class="container">
    <h2 class="text-center mb-4">الطلبات</h2>
    <div id="reservation-list" class="row justify-content-center"></div>
  </div>

  <script>
    const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6ImQxOGZiMmUxLWY0OTktNDZiZS05Y2NjLTBhOGVhZjdhYjA4MyIsInN1YiI6ImhlbmQ2MDc0IiwianRpIjoiOWQ4OGE1ZjYtOTk1NS00ZjY3LWJiNjYtM2E3YmE3ZmQ4ZTM5IiwiZW1haWwiOiJoZW5kQGguY29tIiwidWlkIjoiZDE4ZmIyZTEtZjQ5OS00NmJlLTljY2MtMGE4ZWFmN2FiMDgzIiwiZXhwIjoxNzQ5MDY5MjgyLCJpc3MiOiJTZWN1cmVBcGkiLCJhdWQiOiJTZWN1cmVBcGlVc2VyIn0.RYlFICCJgMFuEEpt9XN5FgQd35ApBEx6JK875RvTOvY";
   fetch("https://localhost:44327/api/Housing/landlordResrvation", {
  headers: {
    "Authorization": `Bearer ${token}`,
    "Content-Type": "application/json"
  }
})
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById("reservation-list");

    // التأكد إن البيانات عبارة عن مصفوفة
    const reservations = Array.isArray(data) ? data : [data];

    if (reservations.length === 0 || !reservations[0]) {
      container.innerHTML = `<p class="text-center">لا توجد طلبات حجز حالياً</p>`;
      return;
    }

    reservations.forEach(item => {
      const card = `
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card p-3 shadow-sm">
            <h5 class="card-title">طلب من: ${item.tenantName}</h5>
            <a href="RequestDetails.html?id=${item.id}" class="btn btn-primary mt-3">عرض التفاصيل</a>
          </div>
        </div>
      `;
      container.innerHTML += card;
    });
  })
  .catch(err => {
    document.getElementById("reservation-list").innerHTML = `<p class="text-danger">تعذر تحميل البيانات</p>`;
    console.error(err);
  });
   const contractModal = document.getElementById("contractModal");
  contractModal.addEventListener('show.bs.modal', function () {
    fetch(`https://localhost:44327/api/Housing/contract/${reservationId}`, {
      headers: {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      }
    })
    .then(res => res.json())
    .then(contract => {
      const date = new Date(contract.reservationDate).toLocaleDateString("ar-EG");
      const html = `
        <p><strong>اسم المؤجر:</strong> ${contract.landlordName}</p>
        <p><strong>هاتف المؤجر:</strong> ${contract.landlordPhone}</p>
        <p><strong>اسم المستأجر:</strong> ${contract.tenantName}</p>
        <p><strong>هاتف المستأجر:</strong> ${contract.tenantPhone}</p>
        <p><strong>العنوان:</strong> ${contract.housingAddress}</p>
        <p><strong>تاريخ الحجز:</strong> ${date}</p>
        <p><strong>المبلغ:</strong> ${contract.amountPaid} جنيه</p>
        <hr>
        <p>تم الاتفاق بين الطرفين على الحجز بالشروط التالية...</p>
        <p>توقيع المؤجر: _______________</p>
        <p>توقيع المستأجر: _______________</p>
      `;
      document.getElementById("contractContent").innerHTML = html;
    });
  });


  </script>
   <script src="js/bootstrap.bundle.min.js"></script>
   <script src="js/tiny-slider.js"></script>
   <script src="js/aos.js"></script>
   <script src="js/navbar.js"></script>
   <script src="js/counter.js"></script>
   <script src="js/custom.js"></script>
   <script>
  fetch('Navbar.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('navbar-placeholder').innerHTML = data;
    });
</script>

</body>
</html>
