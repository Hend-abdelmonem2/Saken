<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="shortcut icon" href="favicon.png" />
  <link rel="stylesheet" href="fonts/icomoon/style.css" />
  <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

  <link rel="stylesheet" href="css/tiny-slider.css" />
  <link rel="stylesheet" href="css/aos.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="shortcut icon" href="favicon.png" />
  <style>
    body {
      background-color: #f7f7f7;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .profile-card {
      max-width: 500px;
      margin: 40px auto;
      padding: 25px;
      background-color: white;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    .profile-img {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
    }
    .btn-custom {
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div id="navbar-placeholder"></div>
<div class="profile-card">
  <img id="profileImage" src="https://placehold.co/110x110" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©" class="profile-img">
  <h4 id="username">...</h4>
  <p id="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ...</p>
  <p id="userType">Ø§Ù„Ù†ÙˆØ¹: ...</p>

  <div class="btn-custom">
   <button class="btn btn-outline-primary w-100 mb-2" onclick="goToEdit()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¤Ø¬Ø± -->
<div id="landlordOptions" style="display: none;">
  <button class="btn btn-outline-success w-100 mb-2" onclick="goToAddHousing()">â• Ø¥Ø¶Ø§ÙØ© Ø³ÙƒÙ†</button>
  <button class="btn btn-outline-info w-100 mb-2" onclick="goToMyHousings()">ğŸ  Ø§Ù„Ø³ÙƒÙ† Ø§Ù„Ø°ÙŠ Ø£Ø¶ÙØªÙ‡</button>
</div>

<!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© -->
<button class="btn btn-outline-secondary w-100 mb-2" onclick="goToSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <button class="btn btn-outline-danger w-100">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</div>

<script>
   const token = localStorage.getItem("token");

function parseJwt(token) {
  try {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
      atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join('')
    );
    return JSON.parse(jsonPayload);
  } catch (e) {
    console.error("Invalid token", e);
    return null;
  }
}

if (!token) {
  alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  window.location.href = "/login.html";
} else {
  const decoded = parseJwt(token);
  if (decoded) {
    const userId = decoded.nameid || decoded.uid || decoded.UserId;
    console.log("User ID from token:", userId);

    const apiUrl = `https://localhost:44327/api/Auth/UserById`;

    fetch(apiUrl, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (!response.ok) throw new Error("ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
      return response.json();
    })
    .then(data => {
      document.getElementById('username').textContent = data.fullName;
      document.getElementById('phone').textContent = `Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${data.phoneNumber}`;
      document.getElementById('userType').textContent = `Ø§Ù„Ù†ÙˆØ¹: ${data.role}`;
      document.getElementById('profileImage').src = data.profilePicture || "https://placehold.co/110x110";

      // Ù„Ùˆ Ù…Ø¤Ø¬Ø±ØŒ Ø£Ø¸Ù‡Ø± Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø¤Ø¬Ø±
      if (data.role === "Owner") {
        document.getElementById('landlordOptions').style.display = 'block';
      }
    })
    .catch(error => {
      console.error('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ");
    });
  }
}
 function goToEdit() {
    window.location.href = `updateProfile.html`;
  }

  function goToAddHousing() {
    window.location.href = `add-housing.html`;
  }

  function goToMyHousings() {
    window.location.href = `houseSetting.html`;
  }

  function goToSettings() {
    window.location.href = `/settings.html?userId=${userId}`;
  }


</script>
 <script src="js/bootstrap.bundle.min.js"></script>
 <script src="js/tiny-slider.js"></script>
 <script src="js/aos.js"></script>
 <script src="js/navbar.js"></script>
 <script src="js/counter.js"></script>
 <script src="js/custom.js"></script>
 <script>
  fetch('Navbar.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('navbar-placeholder').innerHTML = data;
    });
</script>


</body>
</html>
